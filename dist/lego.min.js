function t(t,e,r,n,i,o,s){for(var u=i,l=-1,a=o-i+1;r<=n;){if(s(t[r],e[u])){if(l<0&&(l=r),++u>o)return l}else{if(r+a>n)return-1;l=-1,u=i}r++}return-1}function e(t){for(var e=0;e<t.length;e++){var n=t[e];if(Array.isArray(n))return r(t,t.slice(0,e),e)}return t}function r(t,e,n){for(var i=n;i<t.length;i++){var o=t[i];Array.isArray(o)?r(o,e,0):e.push(o)}return e}function n(t,e,r,n=0,o=t.length-1,s=0,u=e.length-1){var l=function(t,e,r,n=0,i=t.length-1,o=0,s=e.length-1){var u,l,a,d,f,h,c,v=i-n+1,p=s-o+1,y=v+p,g=[];t:for(u=0;u<=y;u++){if(u>50)return;for(c=u-1,f=u>0?g[u-1]:[0,0],h=g[u]=[],l=-u;l<=u;l+=2){for(d=l===-u||l!==u&&f[c+l-1]<f[c+l+1]?f[c+l+1]:f[c+l-1]+1,a=d-l;d<p&&a<v&&r(e[o+d],t[n+a]);)d++,a++;if(d===p&&a===v)break t;h[u+l]=d}}var m,_=Array(u/2+y/2),b={},w=_.length-1;for(u=g.length-1;u>=0;u--){for(;d>0&&a>0&&r(e[o+d-1],t[n+a-1]);)_[w--]=2,d--,a--;if(!u)break;c=u-1,f=u?g[u-1]:[0,0],(l=d-a)===-u||l!==u&&f[c+l-1]<f[c+l+1]?(a--,_[w--]=4):(d--,_[w--]=8,null!=(m=e[o+d]).key&&(b[m.key]=o+d))}return{diff:_,deleteMap:b}}(t,e,r,n,o,s,u);return null!=l?l:function(t,e,r,n,o,s){var u,l,a,d,f,h={},c=[],v=0,p=n-r+1,y=s-o+1,g=Math.min(p,y),m=Array(g+1);m[0]=-1;for(var _=1;_<m.length;_++)m[_]=s+1;var b=Array(g);for(_=o;_<=s;_++)l=e[_],null!=(f=l.key)?h[f]=_:c.push(_);for(_=r;_<=n;_++)u=t[_],null!=(d=null==u.key?c[v++]:h[u.key])&&(a=i(m,d))>=0&&(m[a]=d,b[a]={newi:_,oldi:d,prev:b[a-1]});a=m.length-1;for(;m[a]>s;)a--;var w=b[a],k=Array(y+p-a),S=n,A=s,C=k.length-1;for(;w;){const{newi:t,oldi:e}=w;for(;S>t;)k[C--]=4,S--;for(;A>e;)k[C--]=8,A--;k[C--]=2,S--,A--,w=w.prev}for(;S>=r;)k[C--]=4,S--;for(;A>=o;)k[C--]=8,A--;return{diff:k,deleteMap:h}}(t,e,n,o,s,u)}function i(t,e){for(var r=1,n=t.length-1;r<=n;){var i=Math.ceil((r+n)/2);e<t[i]?n=i-1:r=i+1}return r}const o={selected:!0,value:!0,checked:!0,innerHTML:!0},s="http://www.w3.org/1999/xlink",u={show:s,actuate:s,href:s},l={isSvg:!1};function a(t,e=l){if(S(t))return document.createComment("NULL");if(A(t))return document.createTextNode(String(t));if(C(t)){var r,n,{type:i,props:o,children:s}=t;return"svg"!==i||e.isSvg||(e=Object.assign({},e,{isSVG:!0})),n=v(r=e.isSVG?document.createElementNS("http://www.w3.org/2000/svg",i):document.createElement(i),o,void 0,e.isSVG),h(r,s,0,s.length-1,null,e),null!=n&&c(r,o,void 0,n),r}if(N(t))return t._state={},t.type.mount(t.props,t._state,e);if(void 0===t)throw new Error("mount: vnode is undefined!");throw new Error("mount: Invalid Vnode!")}function d(e,r,i,o=l){if(r===e)return i;if(S(e)&&S(r))return i;if(A(e)&&A(r))return i.nodeValue=String(e),i;if(C(e)&&C(r)&&e.type===r.type){"svg"!==e.type||o.isSvg||(o=Object.assign({},o,{isSVG:!0}));var s=v(i,e.props,r.props,o.isSVG);return function(e,r,i,o){if(r===i)return;var s,u,l,c=0,v=r.length-1,p=0,_=i.length-1,b=Array.from(e.childNodes);for(;c<=v&&p<=_;)if(s=r[c],u=i[p],m(s,u))g(s,u,e,b,p,o),c++,p++;else{if(u=i[_],!m(s=r[v]))break;g(s,u,e,b,_,o),_--,v--}if(c>v&&p>_)return;if(c<=v&&p>_)return void h(e,r,c,v,b[p],o);if(p<=_&&c>v)return void y(e,b,i,p,_);var w=_-p+1,k=v-c+1,S=-1;if(w<k){if((S=t(r,i,c,v,p,_,m))>=0){h(e,r,c,S-1,b[p],o);var A=S+w;for(c=S;c<A;)g(r[c],i[p],e,b,p,o),c++,p++;return _++,void h(e,r,c,v,b[_],o)}}else if(w>k&&(S=t(i,r,p,_,c,v,m))>=0){for(y(e,b,i,p,S-1),A=S+k,p=S;p<A;)g(r[c],i[p],e,b,_,o),c++,p++;return void y(e,b,i,p,_)}if(p===_)return l=b[p],h(e,r,c,v,b[p],o),e.removeChild(l),void f(i[p],l,o);if(c===v)return e.insertBefore(a(r[c],o),b[p]),void y(e,b,i,p,_);var C=n(r,i,m,c,v,p,_);!function(t,e,{diff:r,deleteMap:n},i,o,s,u,l){for(var h,c,v,p,y=0,m=s,_=u;y<r.length;y++){const s=r[y];2===s?(g(i[m],o[_],t,e,_,l),m++,_++):4===s?(h=i[m],null!=(p=null!=h.key?n[h.key]:null)?(v=d(h,o[p],e[p],l),o[p]=void 0):v=a(h,l),t.insertBefore(v,e[_]),m++):8===s&&_++}for(y=0,_=u;y<r.length;y++){const n=r[y];2===n?_++:8===n&&(c=o[_],v=e[_],void 0!==c&&(t.removeChild(v),f(c,v,l)),_++)}}(e,b,C,r,i,c,p,o)}(i,e.children,r.children,o),null!=s&&c(i,e.props,r.props,s),i}return N(e)&&N(r)&&e.type===r.type?(e._state=r._state,e.type.patch(e.props,r.props,e._state,i,o)):a(e,o)}function f(t,e,r){if(!S(t)&&!A(t))if(C(t))for(var n=0;n<t.children.length;n++)f(t.children[n],e.childNodes[n],r);else N(t)&&t.type.unmount(t._state,e,r)}function h(t,e,r=0,n=e.length-1,i,o){for(;r<=n;){var s=e[r++];t.insertBefore(a(s,o),i)}}function c(t,e,r,n){for(var i,o=0;o<n.length;o++){i=n[o];var s=r&&r[i],u=e[i];s!==u&&(t[i]=u)}}function v(t,e,r,n){var i=[];for(var s in e)if(s.startsWith("on")||o.hasOwnProperty(s))i.push(s);else{var u=null!=r?r[s]:void 0,l=e[s];u!==l&&p(t,s,l,n)}for(s in r)s in e||t.removeAttribute(s);if(i.length>0)return i}function p(t,e,r,n){if(!0===r)t.setAttribute(e,"");else if(!1===r)t.removeAttribute(e);else{var i=n?u[e]:void 0;void 0!==i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}}function y(t,e,r,n=0,i=r.length-1){var o;for(e.length===i-n+1&&(t.textContent="",o=!0);n<=i;){var s=r[n],u=e[n];o||t.removeChild(u),n++,f(s,u)}}function g(t,e,r,n,i,o){var s=n[i],u=d(t,e,s,o);return u!=s&&(n[i]=u,r.replaceChild(u,s),f(e,s,o)),u}function m(t,e){return(null!=t&&null!=t.key?t.key:null)===(null!=e&&null!=e.key?e.key:null)}function _(t,e,r,n){if(r!==n)return!0;for(var i in t)if(t[i]!==e[i])return!0;return!1}const b=Symbol("@petit-dom/component");function w(t){var e=t[b];return null==e&&(e=t[b]=function({render:t,shouldUpdate:e=_}){return{mount(e,r,n){var i=t(e);return r.vnode=i,a(i,n)},patch(r,n,i,o,s){if(!e(r,n))return o;var u=t(r),l=i.vnode;return i.vnode=u,d(u,l,o,s)},unmount(t,e,r){t.wasUnmounted=!0,f(t.vnode,e,r)}}}({render:t,shouldUpdate:t.shouldUpdate})),e}const k={},S=t=>null===t,A=t=>"string"==typeof t||"number"==typeof t,C=t=>null!=t&&128===t.vtype,N=t=>null!=t&&256===t.vtype;function O(t,r=k,...n){const i=null!=r?r.key:null;if("string"==typeof t)return{vtype:128,type:t,key:i,props:r,children:e(n)};if(null!=(o=t)&&null!=o.mount&&null!=o.patch&&null!=o.unmount)return{vtype:256,type:t,key:i,props:Object.assign({},r,{children:n}),_state:null};if("function"==typeof t)return{vtype:256,type:w(t),key:i,props:Object.assign({},r,{children:n}),_state:null};var o;throw new Error("h: Invalid type!")}function M(t,e){var r,n=e.$$petitDomState$$;null==n?(r=a(t),e.appendChild(r)):(r=d(t,n.vnode,n.domNode))!==n.domNode&&(e.replaceChild(r,n.domNode),f(n.vnode,n.domNode)),e.$$petitDomState$$={vnode:t,domNode:r}}class j extends HTMLElement{constructor(){super(),this.useShadowDOM=!0,this.__isConnected=!1,this.__state={},this.init&&this.init(),this.watchProps=Object.keys(this.__state),this.__attributesToState(),this.document=this.useShadowDOM?this.attachShadow({mode:"open"}):this}__attributesToState(){Object.assign(this.state,Array.from(this.attributes).reduce((t,e)=>Object.assign(t,{[e.name]:e.value}),{}))}get vdom(){return({state:t})=>""}get vstyle(){return({state:t})=>""}setAttribute(t,e){super.setAttribute(t,e),this.watchProps.includes(t)&&this.render({[t]:e})}removeAttribute(t){super.removeAttribute(t),this.watchProps.includes(t)&&t in this.state&&(this.render({[t]:null}),delete this.state[t])}connectedCallback(){this.__isConnected=!0,this.connected&&this.connected(),this.render()}disconnectedCallback(){this.disconnected&&this.disconnected()}async setState(t={}){Object.assign(this.__state,t),await this.changed(t)}set state(t){this.setState(t)}get state(){return this.__state}async changed(t){}async render(t){if(await this.setState(t),this.__isConnected)return M(O("root",{},[this.vdom({state:this.__state}),this.vstyle({state:this.__state})]),this.document)}}export{j as Component,O as h,M as render};
