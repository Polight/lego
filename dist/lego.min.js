const e={},t=e=>null===e||Array.isArray(e)&&0===e.length,n=e=>Array.isArray(e)&&e.length>0,r=e=>"string"==typeof e||"number"==typeof e,i=e=>1===e?.vtype,o=e=>2===e?.vtype,s=e=>4===e?.vtype;function c(t,n,...r){return n=n??e,function(e,t,n){if(n!=n)throw new Error("Invalid NaN key");const r="string"==typeof e?1:(i=e,"function"==typeof i?.mount?4:"function"==typeof e?2:void 0);var i;if(void 0===r)throw new Error("Invalid VNode type");return{vtype:r,type:e,key:n,props:t}}(t,n=r.length>1?Object.assign({},n,{children:r}):1===r.length?Object.assign({},n,{children:r[0]}):n,n.key)}function l(e){return{mount(t,n){t[e]=n},patch(t,n,r){n!==r&&(t[e]=n)},unmount(t,n){t[e]=null}}}const d={selected:l("selected"),checked:l("checked"),value:l("value"),innerHTML:l("innerHTML")},u="http://www.w3.org/1999/xlink",h={show:u,actuate:u,href:u};function f(e){if(1===e.type)return e.node;if(4===e.type)return f(e.children[0]);if(8===e.type)return f(e.childRef);throw new Error("Unkown ref type "+JSON.stringify(e))}function p(e){if(1===e.type)return e.node.parentNode;if(4===e.type)return p(e.children[0]);if(8===e.type)return p(e.childRef);throw new Error("Unkown ref type "+e)}function a(e){if(1===e.type)return e.node.nextSibling;if(4===e.type)return a(e.children[e.children.length-1]);if(8===e.type)return a(e.childRef);throw new Error("Unkown ref type "+JSON.stringify(e))}function y(e,t,n){if(1===t.type)e.insertBefore(t.node,n);else if(4===t.type)t.children.forEach((t=>{y(e,t,n)}));else{if(8!==t.type)throw new Error("Unkown ref type "+JSON.stringify(t));y(e,t.childRef,n)}}function v(e,t){if(1===t.type)e.removeChild(t.node);else if(4===t.type)t.children.forEach((t=>{v(e,t)}));else{if(8!==t.type)throw new Error("Unkown ref type "+t);v(e,t.childRef)}}function w(e,t,n,r){if(!0===n)e.setAttribute(t,"");else if(!1===n)e.removeAttribute(t);else{var i=r?h[t]:void 0;void 0!==i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}}const g={isSvg:!1,directives:d};class m{constructor(e,t){this.props=e,this._STATE_={env:t,vnode:null,parentDomNode:null,ref:S(null)},this.render=this.render.bind(this)}setProps(e){this.oldProps=this.props,this.props=e}render(e){const t=this._STATE_,n=t.vnode;if(t.vnode=e,null==t.parentDomNode){let n=p(t.ref);if(null==n)return void(t.ref=S(e,t.env));t.parentDomNode=n}t.ref=k(t.parentDomNode,e,n,t.ref,t.env)}}function S(e,c=g){if(t(e))return{type:1,node:document.createComment("NULL")};if(r(e))return{type:1,node:document.createTextNode(e)};if(i(e)){let t,{type:n,props:r}=e;"svg"!==n||c.isSvg||(c=Object.assign({},c,{isSVG:!0})),t=c.isSVG?document.createElementNS("http://www.w3.org/2000/svg",n):document.createElement(n),function(e,t,n){for(var r in t)"key"===r||"children"===r||r in n.directives||(r.startsWith("on")?e[r.toLowerCase()]=t[r]:w(e,r,t[r],n.isSVG))}(t,r,c);let i=null==r.children?r.children:S(r.children,c);return null!=i&&y(t,i),function(e,t,n){for(let r in t)r in n.directives&&n.directives[r].mount(e,t[r])}(t,r,c),{type:1,node:t,children:i}}if(n(e))return{type:4,children:e.map((e=>S(e,c)))};if(o(e)){let t=e.type(e.props);return{type:8,childRef:S(t,c),childState:t}}if(s(e)){let t=new m(e.props,c);return e.type.mount(t),{type:8,childRef:t._STATE_.ref,childState:t}}if(e instanceof Node)return{type:1,node:e};if(void 0===e)throw new Error("mount: vnode is undefined!");throw new Error("mount: Invalid Vnode!")}function _(e,c,l,d,u=g){if(l===c)return d;if(t(c)&&t(l))return d;if(r(c)&&r(l))return d.node.nodeValue=c,d;if(i(c)&&i(l)&&c.type===l.type){"svg"!==c.type||u.isSvg||(u=Object.assign({},u,{isSVG:!0})),function(e,t,n,r){for(var i in t)if("key"!==i&&"children"!==i&&!(i in r.directives)){var o=n[i],s=t[i];o!==s&&(i.startsWith("on")?e[i.toLowerCase()]=s:w(e,i,s,r.isSVG))}for(i in n)"key"===i||"children"===i||i in r.directives||i in t||(i.startsWith("on")?e[i.toLowerCase()]=null:e.removeAttribute(i))}(d.node,c.props,l.props,u);let e=l.props.children,t=c.props.children;return null==e?null!=t&&(d.children=S(t,u),y(d.node,d.children)):null==t?(d.node.textContent="",b(e,d.children,u),d.children=null):d.children=k(d.node,t,e,d.children,u),function(e,t,n,r){for(let i in t)i in r.directives&&r.directives[i].patch(e,t[i],n[i]);for(let i in n)i in r.directives&&!(i in t)&&r.directives[i].unmount(e,n[i])}(d.node,c.props,l.props,u),d}if(n(c)&&n(l))return function(e,t,n,r,i){const o=a(r),s=Array(t.length);let c,l,d,u,h,p=r.children,w=0,g=0,m=t.length-1,E=n.length-1;for(;w<=m&&g<=E;){if(null===p[g]){g++;continue}if(null===p[E]){E--;continue}if(c=n[g],l=t[w],l?.key===c?.key){d=p[g],u=s[w]=k(e,l,c,d,i),w++,g++;continue}if(c=n[E],l=t[m],l?.key===c?.key){d=p[E],u=s[m]=k(e,l,c,d,i),m--,E--;continue}if(null==h){h={};for(let e=g;e<=E;e++)c=n[e],null!=c?.key&&(h[c.key]=e)}l=t[w];const r=null!=l?.key?h[l.key]:null;null!=r?(c=n[r],d=p[r],u=s[w]=_(e,l,c,d,i),y(e,u,f(p[g])),u!==d&&(v(e,d),b(c,d,i)),p[r]=null):(u=s[w]=S(l,i),y(e,u,f(p[g]))),w++}const A=m<t.length-1?f(s[m+1]):o;for(;w<=m;){const n=S(t[w],i);s[w]=n,y(e,n,A),w++}for(;g<=E;)d=p[g],null!=d&&(v(e,d),b(n[g],d,i)),g++;r.children=s}(e,c,l,d,u),d;if(o(c)&&o(l)&&c.type===l.type){let t=c.type;if(null!=t.shouldUpdate?t.shouldUpdate(l.props,c.props):function(e,t){if(e===t)return!1;for(let n in t)if(e[n]!==t[n])return!0;return!1}(l.props,c.props)){let n=t(c.props),r=_(e,n,d.childState,d.childRef,u);return r!==d.childRef?{type:8,childRef:r,childState:n}:(d.childState=n,d)}return d}if(s(c)&&s(l)&&c.type===l.type){const t=d.childState,n=t._STATE_;return n.env=u,n.parentNode=e,t.setProps(c.props),c.type.patch(t),d.childRef!==n.ref?{type:8,childRef:n.ref,childState:t}:d}return c instanceof Node&&l instanceof Node?(d.node=c,d):S(c,u)}function b(e,t,r){i(e)?(!function(e,t,n){for(let r in t)r in n.directives&&n.directives[r].unmount(e,t[r])}(t.node,e.props,r),null!=e.props.children&&b(e.props.children,t.children,r)):n(e)?e.forEach(((e,n)=>b(e,t.children[n],r))):o(e)?b(t.childState,t.childRef,r):s(e)&&e.type.unmount(t.childState)}function k(e,t,n,r,i){const o=_(e,t,n,r,i);return o!==r&&(!function(e,t,n){y(e,t,f(n)),v(e,n)}(e,o,r),b(n,r,i)),o}function E(e,t,n={}){let r=t.$$PETIT_DOM_REF,i=Object.assign({},g);if(Object.assign(i.directives,n.directives),null==r){const n=S(e,i);t.$$PETIT_DOM_REF={ref:n,vnode:e},t.textContent="",y(t,n,null)}else r.ref=k(t,e,r.vnode,r.ref,i),r.vnode=e}class A extends HTMLElement{constructor(){super(),this.useShadowDOM=!0,this.__isConnected=!1,this.__state={},this.init&&this.init(),this.watchProps=Object.keys(this.__state),this.__attributesToState(),this.document=this.useShadowDOM?this.attachShadow({mode:"open"}):this}__attributesToState(){Object.assign(this.state,Array.from(this.attributes).reduce(((e,t)=>Object.assign(e,{[t.name]:t.value})),{}))}get vdom(){return({state:e})=>""}get vstyle(){return({state:e})=>""}setAttribute(e,t){super.setAttribute(e,t),this.watchProps.includes(e)&&this.render({[e]:t})}removeAttribute(e){super.removeAttribute(e),this.watchProps.includes(e)&&e in this.state&&(this.render({[e]:null}),delete this.state[e])}connectedCallback(){this.__isConnected=!0,this.connected&&this.connected(),this.render()}disconnectedCallback(){this.disconnected&&this.disconnected()}async setState(e={}){Object.assign(this.__state,e),await this.changed(e)}set state(e){this.setState(e)}get state(){return this.__state}async changed(e){}async render(e){if(await this.setState(e),this.__isConnected)return E(c("root",{},[this.vdom({state:this.__state}),this.vstyle({state:this.__state})]),this.document)}}export{A as Component,c as h,E as render};
