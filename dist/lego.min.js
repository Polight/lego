const e={},t=1,n=2,r=4,i=e=>null===e||Array.isArray(e)&&0===e.length,o=e=>Array.isArray(e)&&e.length>0,s=e=>"string"==typeof e||"number"==typeof e,c=e=>e?.vtype===t,l=e=>e?.vtype===n,d=e=>e?.vtype===r,u=e=>"function"==typeof e?.mount;function h(i,o,...s){return o=o??e,function(e,i,o){if(o!=o)throw new Error("Invalid NaN key");const s="string"==typeof e?t:u(e)?r:"function"==typeof e?n:void 0;if(void 0===s)throw new Error("Invalid VNode type");return{vtype:s,type:e,key:o,props:i}}(i,o=s.length>1?Object.assign({},o,{children:s}):1===s.length?Object.assign({},o,{children:s[0]}):o,o.key)}const f=1,p=4,a=8,y="http://www.w3.org/2000/svg";function v(e){return{mount(t,n){t[e]=n},patch(t,n,r){n!==r&&(t[e]=n)},unmount(t,n){t[e]=null}}}const w={selected:v("selected"),checked:v("checked"),value:v("value"),innerHTML:v("innerHTML")},m="http://www.w3.org/1999/xlink",g={show:m,actuate:m,href:m};function S(e){if(e.type===f)return e.node;if(e.type===p)return S(e.children[0]);if(e.type===a)return S(e.childRef);throw new Error("Unkown ref type "+JSON.stringify(e))}function b(e){if(e.type===f)return e.node.parentNode;if(e.type===p)return b(e.children[0]);if(e.type===a)return b(e.childRef);throw new Error("Unkown ref type "+e)}function k(e){if(e.type===f)return e.node.nextSibling;if(e.type===p)return k(e.children[e.children.length-1]);if(e.type===a)return k(e.childRef);throw new Error("Unkown ref type "+JSON.stringify(e))}function E(e,t,n){if(t.type===f)e.insertBefore(t.node,n);else if(t.type===p)t.children.forEach((t=>{E(e,t,n)}));else{if(t.type!==a)throw new Error("Unkown ref type "+JSON.stringify(t));E(e,t.childRef,n)}}function A(e,t){if(t.type===f)e.removeChild(t.node);else if(t.type===p)t.children.forEach((t=>{A(e,t)}));else{if(t.type!==a)throw new Error("Unkown ref type "+t);A(e,t.childRef)}}function N(e,t,n,r){if(!0===n)e.setAttribute(t,"");else if(!1===n)e.removeAttribute(t);else{var i=r?g[t]:void 0;void 0!==i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}}const T={isSvg:!1,directives:w};class C{constructor(e,t){this.props=e,this._STATE_={env:t,vnode:null,parentDomNode:null,ref:O(null)},this.render=this.render.bind(this)}setProps(e){this.oldProps=this.props,this.props=e}render(e){const t=this._STATE_,n=t.vnode;if(t.vnode=e,null==t.parentDomNode){let n=b(t.ref);if(null==n)return void(t.ref=O(e,t.env));t.parentDomNode=n}t.ref=U(t.parentDomNode,e,n,t.ref,t.env)}}function O(e,t=T){if(i(e))return{type:f,node:document.createComment("NULL")};if(s(e))return{type:f,node:document.createTextNode(e)};if(c(e)){let n,{type:r,props:i}=e;"svg"!==r||t.isSvg||(t=Object.assign({},t,{isSVG:!0})),n=t.isSVG?document.createElementNS(y,r):document.createElement(r),function(e,t,n){for(var r in t)"key"===r||"children"===r||r in n.directives||(r.startsWith("on")?e[r.toLowerCase()]=t[r]:N(e,r,t[r],n.isSVG))}(n,i,t);let o=null==i.children?i.children:O(i.children,t);return null!=o&&E(n,o),function(e,t,n){for(let r in t)r in n.directives&&n.directives[r].mount(e,t[r])}(n,i,t),{type:f,node:n,children:o}}if(o(e))return{type:p,children:e.map((e=>O(e,t)))};if(l(e)){let n=e.type(e.props),r=O(n,t);return{type:a,childRef:r,childState:n}}if(d(e)){let n=new C(e.props,t);return e.type.mount(n),{type:a,childRef:n._STATE_.ref,childState:n}}if(e instanceof Node)return{type:f,node:e};if(void 0===e)throw new Error("mount: vnode is undefined!");throw new Error("mount: Invalid Vnode!")}function R(e,t,n,r,u=T){if(n===t)return r;if(i(t)&&i(n))return r;if(s(t)&&s(n))return r.node.nodeValue=t,r;if(c(t)&&c(n)&&t.type===n.type){"svg"!==t.type||u.isSvg||(u=Object.assign({},u,{isSVG:!0})),function(e,t,n,r){for(var i in t)if("key"!==i&&"children"!==i&&!(i in r.directives)){var o=n[i],s=t[i];o!==s&&(i.startsWith("on")?e[i.toLowerCase()]=s:N(e,i,s,r.isSVG))}for(i in n)"key"===i||"children"===i||i in r.directives||i in t||(i.startsWith("on")?e[i.toLowerCase()]=null:e.removeAttribute(i))}(r.node,t.props,n.props,u);let e=n.props.children,i=t.props.children;return null==e?null!=i&&(r.children=O(i,u),E(r.node,r.children)):null==i?(r.node.textContent="",_(e,r.children,u),r.children=null):r.children=U(r.node,i,e,r.children,u),function(e,t,n,r){for(let i in t)i in r.directives&&r.directives[i].patch(e,t[i],n[i]);for(let i in n)i in r.directives&&!(i in t)&&r.directives[i].unmount(e,n[i])}(r.node,t.props,n.props,u),r}if(o(t)&&o(n))return function(e,t,n,r,i){const o=k(r),s=Array(t.length);let c,l,d,u,h,f=r.children,p=0,a=0,y=t.length-1,v=n.length-1;for(;p<=y&&a<=v;){if(null===f[a]){a++;continue}if(null===f[v]){v--;continue}if(c=n[a],l=t[p],l?.key===c?.key){d=f[a],u=s[p]=U(e,l,c,d,i),p++,a++;continue}if(c=n[v],l=t[y],l?.key===c?.key){d=f[v],u=s[y]=U(e,l,c,d,i),y--,v--;continue}if(null==h){h={};for(let e=a;e<=v;e++)c=n[e],null!=c?.key&&(h[c.key]=e)}l=t[p];const r=null!=l?.key?h[l.key]:null;null!=r?(c=n[r],d=f[r],u=s[p]=R(e,l,c,d,i),E(e,u,S(f[a])),u!==d&&(A(e,d),_(c,d,i)),f[r]=null):(u=s[p]=O(l,i),E(e,u,S(f[a]))),p++}const w=y<t.length-1?S(s[y+1]):o;for(;p<=y;){const n=O(t[p],i);s[p]=n,E(e,n,w),p++}for(;a<=v;)d=f[a],null!=d&&(A(e,d),_(n[a],d,i)),a++;r.children=s}(e,t,n,r,u),r;if(l(t)&&l(n)&&t.type===n.type){let i=t.type;if(null!=i.shouldUpdate?i.shouldUpdate(n.props,t.props):function(e,t){if(e===t)return!1;for(let n in t)if(e[n]!==t[n])return!0;return!1}(n.props,t.props)){let n=i(t.props),o=R(e,n,r.childState,r.childRef,u);return o!==r.childRef?{type:a,childRef:o,childState:n}:(r.childState=n,r)}return r}if(d(t)&&d(n)&&t.type===n.type){const n=r.childState,i=n._STATE_;return i.env=u,i.parentNode=e,n.setProps(t.props),t.type.patch(n),r.childRef!==i.ref?{type:a,childRef:i.ref,childState:n}:r}return t instanceof Node&&n instanceof Node?(r.node=t,r):O(t,u)}function _(e,t,n){c(e)?(!function(e,t,n){for(let r in t)r in n.directives&&n.directives[r].unmount(e,t[r])}(t.node,e.props,n),null!=e.props.children&&_(e.props.children,t.children,n)):o(e)?e.forEach(((e,r)=>_(e,t.children[r],n))):l(e)?_(t.childState,t.childRef,n):d(e)&&e.type.unmount(t.childState)}function U(e,t,n,r,i){const o=R(e,t,n,r,i);return o!==r&&(!function(e,t,n){E(e,t,S(n)),A(e,n)}(e,o,r),_(n,r,i)),o}function j(e,t,n={}){let r=t.$$PETIT_DOM_REF,i=Object.assign({},T);if(Object.assign(i.directives,n.directives),null==r){const n=O(e,i);t.$$PETIT_DOM_REF={ref:n,vnode:e},t.textContent="",E(t,n,null)}else r.ref=U(t,e,r.vnode,r.ref,i),r.vnode=e}function D(e){return e.includes("-")?e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())):e}class L extends HTMLElement{state={};useShadowDOM=!0;#e=!1;constructor(){super(),this.init?.(),this.watchProps=Object.keys(this.state),this.#t(),this.document=this.useShadowDOM?this.attachShadow({mode:"open"}):this}#t(){this.state=Array.from(this.attributes).reduce(((e,t)=>({...e,[D(t.name)]:t.value})),this.state)}get vdom(){return({state:e})=>""}get vstyle(){return({state:e})=>""}setAttribute(e,t){super.setAttribute(e,t);const n=D(e);this.watchProps.includes(n)&&this.render({[n]:t})}removeAttribute(e){super.removeAttribute(e);const t=D(e);this.watchProps.includes(t)&&t in this.state&&(this.render({[t]:null}),delete this.state[t])}connectedCallback(){this.#e=!0,this.render(),this.connected?.()}disconnectedCallback(){this.#e=!1,this.setState({}),this.disconnected?.()}setState(e={}){Object.assign(this.state,e),this.changed&&this.#e&&this.changed(e)}set state(e){this.setState(e)}get state(){return this.state}render(e){if(this.setState(e),this.#e)return j([this.vdom({state:this.state}),this.vstyle({state:this.state})],this.document)}}export{L as Component,h,j as render};
